define(function(){"use strict";function a(a){for(var b=new Array(a),c=0;a>c;b[c]=c++);return b}function b(a){if(g.isArray(a))return a.map(b);if(g.isNodeList(a)){for(var c=new Array(a.length),d=0;d<a.length;++d)c[d]=b(a[d]);return c}if(g.isHash(a)){for(var e={},f=Object.keys(a),h=0;h<f.length;++h)e[f[h]]=b(a[f[h]]);return e}return a}function c(a){return g.isNull(a)||g.isString(a)||a&&(g.isElement(a)||g.isArray(a)||g.isNodeList(a)||g.isHash(a)||g.isFunction(a))?!0:!1}function d(a){for(var b=[],d=0;d<a.length;++d)if(c(a[d]))if(g.isHash(a[d])?(a[d]=g.createMany(a[d]),1==a[d].length&&(a[d]=a[d][0])):(g.isString(a[d])||g.isNull(a[d]))&&(a[d]=g.create(a[d])),g.isArray(a[d])||g.isNodeList(a[d])||g.isFunction(a[d])){if(!b.length)throw new Error("No element to append to: "+a[d]);a[d]=g.appendChild(b[b.length-1],a[d])}else b.push(a[d]);return b}function f(a){for(var b=new Array(a.length),c=-1,d=a.length;++c>d;b[c]=a[c]);return b}var g={};return g.mapTree=function(a,b){if(g.isFunction(a)&&g.isElement(b)){for(var c=b.childNodes,d=c.length,e=new Array(d),f=0;d>f;f++)g.isUndef(e[f]=a(c[f]))&&(e[f]=g.mapTree(a,c[f]));return e}},g.addOption=function(b,c,d){var e=[];g.isArray(d)?e=d:(g.isString(d)||g.isNumber(d))&&e.push(d),g.isFunction(c)&&(c=c(b));for(var f=g.isArray(c)?a(c.length):Object.keys(c),h=new Array(f.length),i=0;i<f.length;++i){var j=f[i],k=c[j];g.isArray(k)&&k.length>1&&(j=k[0],k=k[1]),h[i]=this.create("option",{value:j,textContent:k}),e.indexOf(j)>=0&&(h[i].selected="selected")}return b&&g.appendChild(b,h),h},g.getSelected=function(a){var b=null;if(g.isElement(a)){var c=a.childNodes;"select-multiple"==a.type&&(b=[]);for(var d=0;d<c.length;++d)if(c[d].selected){if(!b)return d;b.push(d)}}return b?b:-1},g.getSelectedParam=function(a,b){if(!g.isElement(a))return null;b=b||"text";var c=g.getSelected(a),d=a.childNodes;return g.isArray(c)?c.map(function(a){return d[a][b]}):0>c?null:d[c][b]},g.create=function(a,b,c){g.isString(a)&&a.length||(a="text");var d=document.createElement(a);b=b||{};for(var e in b){var f=b[e];if("style"==e&&g.isHash(f))for(var h in f)d.style[h]=f[h];else"choices"==e?g.addOption(d,f,b.value):"childNodes"==e?g.appendChild(d,b.childNodes):d[e]=f}return c&&g.appendChild(d,c),d},g.createCount=function(a,c,d,e){for(var f=new Array(e),h=0;e>h;++h)f[h]=g.create(a,c,b(d));return f},g.createMany=function(a){var b;"_order"in a&&(b=a._order,delete a._order),b=b||Object.keys(a);for(var c=new Array(b.length),d=0;d<b.length;++d)c[d]=g.create(b[d],a[b[d]]);return c},g.removeChildren=function(a){if(!g.isElement(a))return[];for(var b=a.childNodes.length,c=new Array(b);a.hasChildNodes();)c[--b]=a.removeChild(a.lastChild);return c},g.remove=function(a,b){var c=[];if(g.isArray(a)||g.isNodeList(a))for(var d=0;d<a.length;d++)c.push.apply(c,g.remove(a[d],b));else g.isElement(a)&&(b&&a.childNodes&&c.unshift(g.removeChildren(a)),a.parentNode&&c.unshift(a.parentNode.removeChild(a)));return c},g.appendChildCopy=function(a,c){return g.appendChild(a,b(c))},g.appendChild=function(a,b){if(!g.isElement(a))throw new Error("Can append only to dom nodes");var e=[];if(!c(b))return e;g.isFunction(b)&&(b=b(a)||[]),g.isArray(b)?e=b:g.isNodeList(b)?e=f(b):e.push(b);for(var h=d(e),i=0;i<h.length;++i)a.appendChild(h[i]);return h},g.insert=function(a,b,c){var e=c?a.nextSibling:a,f=function(b,c){return a.parentNode.insertBefore(b,c)};if(g.isString(b))return f(g.create(b),e);if(g.isElement(b))return f(b,e);if(g.isHash(b)&&(b=g.createMany(b)),g.isArray(b)||g.isNodeList(b)){b=d(b);for(var h=0;h<b.length;++h)f(b[h],e)}return b},g.getOffset=function(a,b){if(g.isElement(a)){b=b||document.body;for(var c={top:a.offsetTop,left:a.offsetLeft};a.offsetParent!=b&&(a=a.offsetParent);)c.top+=a.offsetTop,c.left+=a.offsetLeft;return c}},g.isElement=function(a){return!(!a||1!=a.nodeType)},g.isArray=function(a){return null!==a&&"object"==typeof a&&"splice"in a&&"join"in a},g.isObject=function(a){return a&&"object"==typeof a&&(a==window||a instanceof Object)},g.isHash=function(a){return g.isObject(a)&&!a.nodeName&&!g.isArray(a)},g.isNodeList=function(a){return a&&"object"==typeof a&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(a))&&"number"==typeof a.length&&"function"==typeof a.item&&(0===a.length||"object"==typeof a[0]&&a[0].nodeType>0)},g.isFunction=function(a){return"function"==typeof a},g.isString=function(a){return"string"==typeof a},g.isNumber=function(a){return"number"==typeof a},g.isError=function(a){return a instanceof Error||"object"==typeof e&&"[object Error]"===Object.prototype.toString.call(e)},g.isNull=function(a){return null===a},g.isUndef=function(a){return"undefined"==typeof a},g.t={range:a,deepCopy:b,appendable:c,createRecursive:d},g});